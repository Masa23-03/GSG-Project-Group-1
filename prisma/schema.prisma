generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

enum UserRole {
  PATIENT
  PHARMACY
  DRIVER
  ADMIN
}

enum UserStatus {
  ACTIVE
  INACTIVE
}

enum VerificationStatus {
  UNDER_REVIEW
  VERIFIED
  REJECTED
}

model User {
  id              BigInt     @id @default(autoincrement()) @db.UnsignedBigInt
  email           String     @unique @db.VarChar(255)
  password        String     @db.VarChar(255)
  role            UserRole   @default(PATIENT)
  status          UserStatus @default(ACTIVE)
  name            String     @db.VarChar(255)
  phoneNumber     String     @map("phone_number") @db.VarChar(255)
  dateOfBirth     DateTime?  @db.Date()
  profileImageUrl String?    @map("profile_image_url") @db.VarChar(255)
  createdAt       DateTime   @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt       DateTime   @updatedAt @map("updated_at") @db.DateTime(0)

  pharmacy           Pharmacy?  @relation("PharmacyOwner")
  verifiedPharmacies Pharmacy[] @relation("PharmacyVerifier")

  @@index([role], map: "idx_users_role")
  @@index([status], map: "idx_users_status")
  @@map("users")
}

model Pharmacy {
  id                 BigInt             @id @default(autoincrement()) @db.UnsignedBigInt
  userId             BigInt             @unique @db.UnsignedBigInt
  verifiedBy         BigInt?            @db.UnsignedBigInt
  pharmacyName       String             @map("pharmacy_name") @db.VarChar(255)
  licenseNumber      String             @unique @map("license_number") @db.VarChar(255)
  licenseDocumentUrl String?            @map("license_document_url") @db.VarChar(255)
  city               String             @db.VarChar(255)
  address            String             @db.Text
  latitude           Decimal?           @db.Decimal()
  longitude          Decimal?           @db.Decimal()
  coverImageUrl      String?            @map("cover_image_url") @db.VarChar(255)
  verificationStatus VerificationStatus @default(UNDER_REVIEW) @map("verification_status")
  verifiedAt         DateTime?          @map("verified_at") @db.Timestamp()
  workOpenTime       DateTime?          @map("work_open_time") @db.Time()
  workCloseTime      DateTime?          @map("work_close_time") @db.Time()
  avgPrepTimeMinutes Int                @default(10) @map("avg_prep_time_minutes") @db.TinyInt
  createdAt          DateTime           @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt          DateTime           @updatedAt @map("updated_at") @db.DateTime(0)

  // owner (1–1)
  user  User  @relation("PharmacyOwner", fields: [userId], references: [id])
  // verifier (admin, 1–many)
  admin User? @relation("PharmacyVerifier", fields: [verifiedBy], references: [id])

  @@index([verificationStatus], map: "idx_pharmacies_verified")
  @@index([city], map: "idx_pharmacies_cities")
  @@map("pharmacies")
}

model Driver {
  id         BigInt  @id @default(autoincrement()) @db.UnsignedBigInt
  userId     BigInt  @unique @db.UnsignedBigInt
  verifiedBy BigInt? @db.UnsignedBigInt
}
